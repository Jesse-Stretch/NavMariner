
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>NavMariner</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
html, body {
  margin: 0;
  height: 100%;
  font-family: Arial, sans-serif;
}

#map { height: 100%; }

.control {
  position: absolute;
  top: 10px;
  left: 10px;
  background: rgba(0,0,0,0.85);
  color: white;
  padding: 10px;
  border-radius: 8px;
  z-index: 1000;
  width: 260px;
}

.control input, .control select {
  width: 100%;
  padding: 6px;
  margin: 4px 0;
  font-size: 16px;
}

.control button {
  width: 100%;
  margin-top: 6px;
  padding: 8px;
  font-size: 16px;
  background: #f2c94c;
  border: none;
  border-radius: 4px;
}

#info {
  position: absolute;
  bottom: 10px;
  left: 10px;
  background: rgba(0,0,0,0.8);
  color: white;
  padding: 8px;
  border-radius: 6px;
  font-size: 14px;
  z-index: 1000;
}
</style>
</head>

<body>

<div class="control">
  <strong>Add Waypoint</strong>

  <input id="lat" type="number" step="any" placeholder="Latitude (e.g. 49.2827)">
  <select id="latDir">
    <option value="N">North</option>
    <option value="S">South</option>
  </select>

  <input id="lon" type="number" step="any" placeholder="Longitude (e.g. 123.1207)">
  <select id="lonDir">
    <option value="W">West</option>
    <option value="E">East</option>
  </select>

  <input id="speed" type="number" step="any" value="20" placeholder="Speed (knots)">

  <button onclick="addWaypointManual()">Add Waypoint</button>
  <button onclick="recenter()">Recenter on Me</button>
  <button onclick="clearRoute()">Clear Route</button>
</div>

<div id="info">
  Distance: <span id="distance">0</span> NM<br>
  ETA: <span id="eta">0</span> min<br>
  Cursor: <span id="cursor">--</span>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
let map = L.map("map").setView([49.2827, -123.1207], 10);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  maxZoom: 18
}).addTo(map);

let waypoints = [];
let routeLine = L.polyline([], { color: "yellow" }).addTo(map);
let previewLine = L.polyline([], { color: "orange", dashArray: "5,5" }).addTo(map);
let currentPos = null;

navigator.geolocation.getCurrentPosition(pos => {
  currentPos = [pos.coords.latitude, pos.coords.longitude];
  map.setView(currentPos, 12);
});

map.on("click", e => addWaypoint(e.latlng.lat, e.latlng.lng));

map.on("mousemove", e => {
  document.getElementById("cursor").innerText =
    e.latlng.lat.toFixed(5) + ", " + e.latlng.lng.toFixed(5);

  if (waypoints.length)
    previewLine.setLatLngs([waypoints[waypoints.length - 1], e.latlng]);
});

function addWaypoint(lat, lon) {
  waypoints.push([lat, lon]);
  L.circleMarker([lat, lon], { radius: 6, color: "red" }).addTo(map);
  updateRoute();
}

function addWaypointManual() {
  let lat = parseFloat(document.getElementById("lat").value);
  let lon = parseFloat(document.getElementById("lon").value);
  let latDir = document.getElementById("latDir").value;
  let lonDir = document.getElementById("lonDir").value;

  if (isNaN(lat) || isNaN(lon)) {
    alert("Enter numeric values only.");
    return;
  }

  if (latDir === "S") lat *= -1;
  if (lonDir === "W") lon *= -1;

  if (Math.abs(lat) > 90 || Math.abs(lon) > 180) {
    alert("Invalid coordinate range.");
    return;
  }

  addWaypoint(lat, lon);
}

function updateRoute() {
  routeLine.setLatLngs(waypoints);
  previewLine.setLatLngs([]);
  updateStats();
}

function clearRoute() {
  waypoints = [];
  routeLine.setLatLngs([]);
  previewLine.setLatLngs([]);
  document.getElementById("distance").innerText = "0";
  document.getElementById("eta").innerText = "0";
}

function updateStats() {
  let meters = 0;
  for (let i = 1; i < waypoints.length; i++)
    meters += map.distance(waypoints[i - 1], waypoints[i]);

  let nm = meters / 1852;
  document.getElementById("distance").innerText = nm.toFixed(2);

  let speed = parseFloat(document.getElementById("speed").value);
  if (speed > 0)
    document.getElementById("eta").innerText = Math.round((nm / speed) * 60);
}

function recenter() {
  if (currentPos) map.setView(currentPos, 12);
}
</script>

</body>
</html>
